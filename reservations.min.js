!function(){function require(path,parent,orig){var resolved=require.resolve(path);if(null==resolved){orig=orig||path;parent=parent||"root";var err=new Error('Failed to require "'+orig+'" from "'+parent+'"');err.path=orig;err.parent=parent;err.require=true;throw err}var module=require.modules[resolved];if(!module.exports){module.exports={};module.client=module.component=true;module.call(this,module.exports,require.relative(resolved),module)}return module.exports}require.modules={};require.aliases={};require.resolve=function(path){if(path.charAt(0)==="/")path=path.slice(1);var index=path+"/index.js";var paths=[path,path+".js",path+".json",path+"/index.js",path+"/index.json"];for(var i=0;i<paths.length;i++){var path=paths[i];if(require.modules.hasOwnProperty(path))return path}if(require.aliases.hasOwnProperty(index)){return require.aliases[index]}};require.normalize=function(curr,path){var segs=[];if("."!=path.charAt(0))return path;curr=curr.split("/");path=path.split("/");for(var i=0;i<path.length;++i){if(".."==path[i]){curr.pop()}else if("."!=path[i]&&""!=path[i]){segs.push(path[i])}}return curr.concat(segs).join("/")};require.register=function(path,definition){require.modules[path]=definition};require.alias=function(from,to){if(!require.modules.hasOwnProperty(from)){throw new Error('Failed to alias "'+from+'", it does not exist')}require.aliases[to]=from};require.relative=function(parent){var p=require.normalize(parent,"..");function lastIndexOf(arr,obj){var i=arr.length;while(i--){if(arr[i]===obj)return i}return-1}function localRequire(path){var resolved=localRequire.resolve(path);return require(resolved,parent,path)}localRequire.resolve=function(path){var c=path.charAt(0);if("/"==c)return path.slice(1);if("."==c)return require.normalize(p,path);var segs=parent.split("/");var i=lastIndexOf(segs,"deps")+1;if(!i)i=0;path=segs.slice(0,i+1).join("/")+"/deps/"+path;return path};localRequire.exists=function(path){return require.modules.hasOwnProperty(localRequire.resolve(path))};return localRequire};require.register("component-indexof/index.js",function(exports,require,module){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}});require.register("component-classes/index.js",function(exports,require,module){var index=require("indexof");var re=/\s+/;var toString=Object.prototype.toString;module.exports=function(el){return new ClassList(el)};function ClassList(el){this.el=el;this.list=el.classList}ClassList.prototype.add=function(name){if(this.list){this.list.add(name);return this}var arr=this.array();var i=index(arr,name);if(!~i)arr.push(name);this.el.className=arr.join(" ");return this};ClassList.prototype.remove=function(name){if("[object RegExp]"==toString.call(name)){return this.removeMatching(name)}if(this.list){this.list.remove(name);return this}var arr=this.array();var i=index(arr,name);if(~i)arr.splice(i,1);this.el.className=arr.join(" ");return this};ClassList.prototype.removeMatching=function(re){var arr=this.array();for(var i=0;i<arr.length;i++){if(re.test(arr[i])){this.remove(arr[i])}}return this};ClassList.prototype.toggle=function(name){if(this.list){this.list.toggle(name);return this}if(this.has(name)){this.remove(name)}else{this.add(name)}return this};ClassList.prototype.array=function(){var arr=this.el.className.split(re);if(""===arr[0])arr.pop();return arr};ClassList.prototype.has=ClassList.prototype.contains=function(name){return this.list?this.list.contains(name):!!~index(this.array(),name)}});require.register("component-event/index.js",function(exports,require,module){exports.bind=function(el,type,fn,capture){if(el.addEventListener){el.addEventListener(type,fn,capture||false)}else{el.attachEvent("on"+type,fn)}return fn};exports.unbind=function(el,type,fn,capture){if(el.removeEventListener){el.removeEventListener(type,fn,capture||false)}else{el.detachEvent("on"+type,fn)}return fn}});require.register("component-autoscale-canvas/index.js",function(exports,require,module){module.exports=function(canvas){var ctx=canvas.getContext("2d");var ratio=window.devicePixelRatio||1;if(1!=ratio){canvas.style.width=canvas.width+"px";canvas.style.height=canvas.height+"px";canvas.width*=ratio;canvas.height*=ratio;ctx.scale(ratio,ratio)}return canvas}});require.register("component-raf/index.js",function(exports,require,module){module.exports=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||fallback;var prev=(new Date).getTime();function fallback(fn){var curr=(new Date).getTime();var ms=Math.max(0,16-(curr-prev));setTimeout(fn,ms);prev=curr}});require.register("component-spinner/index.js",function(exports,require,module){var autoscale=require("autoscale-canvas");var raf=require("raf");module.exports=Spinner;function Spinner(){var self=this;this.percent=0;this.el=document.createElement("canvas");this.ctx=this.el.getContext("2d");this.size(50);this.fontSize(11);this.speed(60);this.font("helvetica, arial, sans-serif");this.stopped=false;!function animate(){if(self.stopped)return;raf(animate);self.percent=(self.percent+self._speed/36)%100;self.draw(self.ctx)}()}Spinner.prototype.stop=function(){this.stopped=true};Spinner.prototype.size=function(n){this.el.width=n;this.el.height=n;autoscale(this.el);return this};Spinner.prototype.text=function(str){this._text=str;return this};Spinner.prototype.fontSize=function(n){this._fontSize=n;return this};Spinner.prototype.font=function(family){this._font=family;return this};Spinner.prototype.speed=function(n){this._speed=n;return this};Spinner.prototype.light=function(){this._light=true;return this};Spinner.prototype.draw=function(ctx){var percent=Math.min(this.percent,100),ratio=window.devicePixelRatio||1,size=this.el.width/ratio,half=size/2,x=half,y=half,rad=half-1,fontSize=this._fontSize,light=this._light;ctx.font=fontSize+"px "+this._font;var angle=Math.PI*2*(percent/100);ctx.clearRect(0,0,size,size);var grad=ctx.createLinearGradient(half+Math.sin(Math.PI*1.5-angle)*half,half+Math.cos(Math.PI*1.5-angle)*half,half+Math.sin(Math.PI*.5-angle)*half,half+Math.cos(Math.PI*.5-angle)*half);if(light){grad.addColorStop(0,"rgba(255, 255, 255, 0)");grad.addColorStop(1,"rgba(255, 255, 255, 1)")}else{grad.addColorStop(0,"rgba(0, 0, 0, 0)");grad.addColorStop(1,"rgba(0, 0, 0, 1)")}ctx.strokeStyle=grad;ctx.beginPath();ctx.arc(x,y,rad,angle-Math.PI,angle,false);ctx.stroke();ctx.strokeStyle=light?"rgba(255, 255, 255, .4)":"#eee";ctx.beginPath();ctx.arc(x,y,rad-1,0,Math.PI*2,true);ctx.stroke();var text=this._text||"",w=ctx.measureText(text).width;if(light)ctx.fillStyle="rgba(255, 255, 255, .9)";ctx.fillText(text,x-w/2+1,y+fontSize/2-1);return this}});require.register("component-type/index.js",function(exports,require,module){var toString=Object.prototype.toString;module.exports=function(val){switch(toString.call(val)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object String]":return"string"}if(val===null)return"null";if(val===undefined)return"undefined";if(val&&val.nodeType===1)return"element";if(val===Object(val))return"object";return typeof val}});require.register("component-value/index.js",function(exports,require,module){var typeOf=require("type");module.exports=function(el,val){if(2==arguments.length)return set(el,val);return get(el)};function get(el){switch(type(el)){case"checkbox":case"radio":if(el.checked){var attr=el.getAttribute("value");return null==attr?true:attr}else{return false}case"radiogroup":for(var i=0,radio;radio=el[i];i++){if(radio.checked)return radio.value}break;case"select":for(var i=0,option;option=el.options[i];i++){if(option.selected)return option.value}break;default:return el.value}}function set(el,val){switch(type(el)){case"checkbox":case"radio":if(val){el.checked=true}else{el.checked=false}break;case"radiogroup":for(var i=0,radio;radio=el[i];i++){radio.checked=radio.value===val}break;case"select":for(var i=0,option;option=el.options[i];i++){option.selected=option.value===val}break;default:el.value=val}}function type(el){var group="array"==typeOf(el)||"object"==typeOf(el);if(group)el=el[0];var name=el.nodeName.toLowerCase();var type=el.getAttribute("type");if(group&&type&&"radio"==type.toLowerCase())return"radiogroup";if("input"==name&&type&&"checkbox"==type.toLowerCase())return"checkbox";if("input"==name&&type&&"radio"==type.toLowerCase())return"radio";if("select"==name)return"select";return name}});require.register("jb55-domready/index.js",function(exports,require,module){!function(name,definition){if(typeof module!="undefined")module.exports=definition();else if(typeof define=="function"&&typeof define.amd=="object")define(definition);else this[name]=definition()}("domready",function(ready){var fns=[],fn,f=false,doc=document,testEl=doc.documentElement,hack=testEl.doScroll,domContentLoaded="DOMContentLoaded",addEventListener="addEventListener",onreadystatechange="onreadystatechange",readyState="readyState",loaded=/^loade|c/.test(doc[readyState]);function flush(f){loaded=1;while(f=fns.shift())f()}doc[addEventListener]&&doc[addEventListener](domContentLoaded,fn=function(){doc.removeEventListener(domContentLoaded,fn,f);flush()},f);hack&&doc.attachEvent(onreadystatechange,fn=function(){if(/^c/.test(doc[readyState])){doc.detachEvent(onreadystatechange,fn);flush()}});return ready=hack?function(fn){self!=top?loaded?fn():fns.push(fn):function(){try{testEl.doScroll("left")}catch(e){return setTimeout(function(){ready(fn)},50)}fn()}()}:function(fn){loaded?fn():fns.push(fn)}})});require.register("visionmedia-debug/index.js",function(exports,require,module){if("undefined"==typeof window){module.exports=require("./lib/debug")}else{module.exports=require("./debug")}});require.register("visionmedia-debug/debug.js",function(exports,require,module){module.exports=debug;function debug(name){if(!debug.enabled(name))return function(){};return function(fmt){fmt=coerce(fmt);var curr=new Date;var ms=curr-(debug[name]||curr);debug[name]=curr;fmt=name+" "+fmt+" +"+debug.humanize(ms);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}}debug.names=[];debug.skips=[];debug.enable=function(name){try{localStorage.debug=name}catch(e){}var split=(name||"").split(/[\s,]+/),len=split.length;for(var i=0;i<len;i++){name=split[i].replace("*",".*?");if(name[0]==="-"){debug.skips.push(new RegExp("^"+name.substr(1)+"$"))}else{debug.names.push(new RegExp("^"+name+"$"))}}};debug.disable=function(){debug.enable("")};debug.humanize=function(ms){var sec=1e3,min=60*1e3,hour=60*min;if(ms>=hour)return(ms/hour).toFixed(1)+"h";if(ms>=min)return(ms/min).toFixed(1)+"m";if(ms>=sec)return(ms/sec|0)+"s";return ms+"ms"};debug.enabled=function(name){for(var i=0,len=debug.skips.length;i<len;i++){if(debug.skips[i].test(name)){return false}}for(var i=0,len=debug.names.length;i<len;i++){if(debug.names[i].test(name)){return true}}return false};function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}if(window.localStorage)debug.enable(localStorage.debug)});require.register("component-emitter/index.js",function(exports,require,module){var index=require("indexof");module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}fn._off=on;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var i=index(callbacks,fn._off||fn);if(~i)callbacks.splice(i,1);return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}});require.register("RedVentures-reduce/index.js",function(exports,require,module){module.exports=function(arr,fn,initial){var idx=0;var len=arr.length;var curr=arguments.length==3?initial:arr[idx++];while(idx<len){curr=fn.call(null,curr,arr[idx],++idx,arr)}return curr}});require.register("visionmedia-superagent/lib/client.js",function(exports,require,module){var Emitter=require("emitter");var reduce=require("reduce");var root="undefined"==typeof window?this:window;function noop(){}function isHost(obj){var str={}.toString.call(obj);switch(str){case"[object File]":case"[object Blob]":case"[object FormData]":return true;default:return false}}function getXHR(){if(root.XMLHttpRequest&&("file:"!=root.location.protocol||!root.ActiveXObject)){return new XMLHttpRequest}else{try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}return false}var trim="".trim?function(s){return s.trim()}:function(s){return s.replace(/(^\s*|\s*$)/g,"")};function isObject(obj){return obj===Object(obj)}function serialize(obj){if(!isObject(obj))return obj;var pairs=[];for(var key in obj){pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(obj[key]))}return pairs.join("&")}request.serializeObject=serialize;function parseString(str){var obj={};var pairs=str.split("&");var parts;var pair;for(var i=0,len=pairs.length;i<len;++i){pair=pairs[i];parts=pair.split("=");obj[decodeURIComponent(parts[0])]=decodeURIComponent(parts[1])}return obj}request.parseString=parseString;request.types={html:"text/html",json:"application/json",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"};request.serialize={"application/x-www-form-urlencoded":serialize,"application/json":JSON.stringify};request.parse={"application/x-www-form-urlencoded":parseString,"application/json":JSON.parse};function parseHeader(str){var lines=str.split(/\r?\n/);var fields={};var index;var line;var field;var val;lines.pop();for(var i=0,len=lines.length;i<len;++i){line=lines[i];index=line.indexOf(":");field=line.slice(0,index).toLowerCase();val=trim(line.slice(index+1));fields[field]=val}return fields}function type(str){return str.split(/ *; */).shift()}function params(str){return reduce(str.split(/ *; */),function(obj,str){var parts=str.split(/ *= */),key=parts.shift(),val=parts.shift();if(key&&val)obj[key]=val;return obj},{})}function Response(xhr,options){options=options||{};this.xhr=xhr;this.text=xhr.responseText;this.setStatusProperties(xhr.status);this.header=this.headers=parseHeader(xhr.getAllResponseHeaders());this.header["content-type"]=xhr.getResponseHeader("content-type");this.setHeaderProperties(this.header);this.body=this.parseBody(this.text)}Response.prototype.get=function(field){return this.header[field.toLowerCase()]};Response.prototype.setHeaderProperties=function(header){var ct=this.header["content-type"]||"";this.type=type(ct);var obj=params(ct);for(var key in obj)this[key]=obj[key]};Response.prototype.parseBody=function(str){var parse=request.parse[this.type];return parse?parse(str):null};Response.prototype.setStatusProperties=function(status){var type=status/100|0;this.status=status;this.statusType=type;this.info=1==type;this.ok=2==type;this.clientError=4==type;this.serverError=5==type;this.error=4==type||5==type?this.toError():false;this.accepted=202==status;this.noContent=204==status||1223==status;this.badRequest=400==status;this.unauthorized=401==status;this.notAcceptable=406==status;this.notFound=404==status;this.forbidden=403==status};Response.prototype.toError=function(){var msg="got "+this.status+" response";var err=new Error(msg);err.status=this.status;return err};request.Response=Response;function Request(method,url){var self=this;Emitter.call(this);this._query=this._query||[];this.method=method;this.url=url;this.header={};this._header={};this.set("X-Requested-With","XMLHttpRequest");this.on("end",function(){var res=new Response(self.xhr);if("HEAD"==method)res.text=null;self.callback(null,res)})}Request.prototype=new Emitter;Request.prototype.constructor=Request;Request.prototype.timeout=function(ms){this._timeout=ms;return this};Request.prototype.clearTimeout=function(){this._timeout=0;clearTimeout(this._timer);return this};Request.prototype.abort=function(){if(this.aborted)return;this.aborted=true;this.xhr.abort();this.clearTimeout();this.emit("abort");return this};Request.prototype.set=function(field,val){if(isObject(field)){for(var key in field){this.set(key,field[key])}return this}this._header[field.toLowerCase()]=val;this.header[field]=val;return this};Request.prototype.getHeader=function(field){return this._header[field.toLowerCase()]};Request.prototype.type=function(type){this.set("Content-Type",request.types[type]||type);return this};Request.prototype.auth=function(user,pass){var str=btoa(user+":"+pass);this.set("Authorization","Basic "+str);return this};Request.prototype.query=function(val){if("string"!=typeof val)val=serialize(val);this._query.push(val);return this};Request.prototype.send=function(data){var obj=isObject(data);var type=this.getHeader("Content-Type");if(obj&&isObject(this._data)){for(var key in data){this._data[key]=data[key]}}else if("string"==typeof data){if(!type)this.type("form");type=this.getHeader("Content-Type");if("application/x-www-form-urlencoded"==type){this._data=this._data?this._data+"&"+data:data}else{this._data=(this._data||"")+data}}else{this._data=data}if(!obj)return this;if(!type)this.type("json");return this};Request.prototype.callback=function(err,res){var fn=this._callback;if(2==fn.length)return fn(err,res);if(err)return this.emit("error",err);fn(res)};Request.prototype.crossDomainError=function(){var err=new Error("Origin is not allowed by Access-Control-Allow-Origin");err.crossDomain=true;this.callback(err)};Request.prototype.timeoutError=function(){var timeout=this._timeout;var err=new Error("timeout of "+timeout+"ms exceeded");err.timeout=timeout;this.callback(err)};Request.prototype.withCredentials=function(){this._withCredentials=true;return this};Request.prototype.end=function(fn){var self=this;var xhr=this.xhr=getXHR();var query=this._query.join("&");var timeout=this._timeout;var data=this._data;this._callback=fn||noop;if(this._withCredentials)xhr.withCredentials=true;xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(0==xhr.status){if(self.aborted)return self.timeoutError();return self.crossDomainError()}self.emit("end")};if(xhr.upload){xhr.upload.onprogress=function(e){e.percent=e.loaded/e.total*100;self.emit("progress",e)}}if(timeout&&!this._timer){this._timer=setTimeout(function(){self.abort()},timeout)}if(query){query=request.serializeObject(query);this.url+=~this.url.indexOf("?")?"&"+query:"?"+query}xhr.open(this.method,this.url,true);if("GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof data&&!isHost(data)){var serialize=request.serialize[this.getHeader("Content-Type")];if(serialize)data=serialize(data)}for(var field in this.header){if(null==this.header[field])continue;xhr.setRequestHeader(field,this.header[field])}xhr.send(data);return this};request.Request=Request;function request(method,url){if("function"==typeof url){return new Request("GET",method).end(url)}if(1==arguments.length){return new Request("GET",method)}return new Request(method,url)}request.get=function(url,data,fn){var req=request("GET",url);if("function"==typeof data)fn=data,data=null;if(data)req.query(data);if(fn)req.end(fn);return req};request.head=function(url,data,fn){var req=request("HEAD",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.del=function(url,fn){var req=request("DELETE",url);if(fn)req.end(fn);return req};request.patch=function(url,data,fn){var req=request("PATCH",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.post=function(url,data,fn){var req=request("POST",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.put=function(url,data,fn){var req=request("PUT",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};module.exports=request});require.register("reservation-form.js/index.js",function(exports,require,module){var alertTemplate=require("./template/alert"),classes=require("classes"),confirmTemplate=require("./template/confirm"),debug=require("debug")("reservations.js"),domready=require("domready"),events=require("event"),form=require("./template/form"),Spinner=require("spinner"),success=require("./template/success"),superagent=require("superagent"),value=require("value");var PERFECT_API_KEY=null,PERFECT_API_URL="https://api.perfec.tt/restaurant/public",PERFECT_API_VERSION="1.4.0";module.exports.activate=function(key){debug("activating with %s",key);PERFECT_API_KEY=key;domready(function(){debug("authenticating");get("/auth",function(err){if(err){debug(err);window.alert("Unable to load Perfect form.\n"+err.message)}else{debug("authenticated");setup()}})})};function setup(){debug("showing reservation form");var $perfect=document.getElementById("perfect-reservation-form");$perfect.innerHTML=form();var $form=$perfect.getElementsByTagName("form")[0],$date=document.getElementById("perfect-date"),$partySize=document.getElementById("perfect-party-size"),$phone=document.getElementById("perfect-phone");value($date,(new Date).toISOString().substring(0,10));events.bind($form,"submit",handleFormSubmission);events.bind($date,"change",handleDateChange);events.bind($partySize,"change",retrieveAvailableTimes);events.bind($phone,"keydown",numericInputOnly);getAvailablePartySizes()}function handleFormSubmission(event){event.preventDefault();debug("handling form submission");var $alerts=document.getElementById("perfect-alerts"),$create=document.getElementById("perfect-create"),$date=document.getElementById("perfect-date"),$form=document.getElementById("perfect-reservation-form"),$fieldset=$form.getElementsByTagName("fieldset")[0],$name=document.getElementById("perfect-name"),$phone=document.getElementById("perfect-phone"),$time=document.getElementById("perfect-time");$alerts.innerHTML=null;var displayTime=$time.options[$time.selectedIndex].innerText,displayDate=value($date);var reservation={name:value($name),phone:parseInt(value($phone),10),partySize:getPartySize(),date:getDate(),time:parseInt(value($time),10)};if(isValidData(reservation)){$create.style.display="none";$fieldset.innerHTML+=confirmTemplate({partySize:reservation.partySize,time:displayTime,date:displayDate,name:reservation.name});var $goBack=document.getElementById("perfect-go-back"),$confirmButton=document.getElementById("perfect-confirm-button");events.bind($goBack,"click",function(e){debug("going back to the form");e.preventDefault();document.getElementById("perfect-confirm").remove();document.getElementById("perfect-create").style.display="block";setTimeAndSubmitDisabled(true)});events.bind($confirmButton,"click",function(e){debug("confirming reservation for %s of %s at %s on %s",reservation.name,reservation.partySize,reservation.time,reservation.date);e.preventDefault();reservation.time=midnight(reservation.date).valueOf()+reservation.time*1e3*60;delete reservation.date;post("/reservations",reservation,function(err){document.getElementById("perfect-confirm").remove();if(err){document.getElementById("perfect-create").style.display="block";addAlert("form","There was a problem creating your reservation. If you have already created a reservation with this phone number you will not be able to create a second on the same day. Please refresh the page and try again.")}else{$fieldset.innerHTML+=success({partySize:reservation.partySize,time:displayTime,date:displayDate})}})})}return false}function handleDateChange(event){debug("handling date change");var date=getDate(),today=midnight(new Date);if(date.valueOf()<today.valueOf()){value(event.target,today.toISOString().substring(0,10))}else if(today.getMonth()<date.getMonth()&&today.getDate()<date.getDate()){addAlert("date","Reservation date must be within 30 days.")}else{retrieveAvailableTimes()}}function retrieveAvailableTimes(){debug("retrieving available times");var $alerts=document.getElementById("perfect-alerts"),partySize=getPartySize(),date=getDate(),$time=document.getElementById("perfect-time");$alerts.innerHTML=null;if(isNaN(date.getTime())||date.valueOf()<midnight(new Date).valueOf()||partySize===0){setTimeAndSubmitDisabled(true)}else{get("/reservations/availableTimes/"+partySize+"/"+date.getFullYear()+"/"+(date.getMonth()+1)+"/"+date.getDate(),function(err,data){if(!err){$time.innerHTML=null;if(data.length&&data.length>0){for(var i=0;i<data.length;i++){var time=data[i],h=time>720?time/60-12:time/60,m=time%60===0?"00":""+time%60,a=time>720?" pm":" am",format=parseInt(h,10)+":"+m+a,option=document.createElement("option");option.innerHTML=format;option.value=time;$time.appendChild(option)}setTimeAndSubmitDisabled(false)}else{addAlert("date","No reservations available for parties of "+partySize+" on "+date)}}})}}function getAvailablePartySizes(){debug("get available party sizes");get("/reservations/partySizes",function(err,partySizes){if(!err){var $partySize=document.getElementById("perfect-party-size");for(var i=0;i<partySizes.length;i++){var option=document.createElement("option"),size=partySizes[i];option.innerText=size;option.value=size;$partySize.appendChild(option)}}})}function isValidData(data){debug("validating data");var name=data.name,phone=data.phone,date=data.date,partySize=data.partySize,time=data.time,valid=true;if(!time||time===0){addAlert("time","Time selected is invalid.");valid=false}if(isNaN(date)){addAlert("date","Date is an invalid format.");valid=false}if(!date){addAlert("date","You must select a date.");valid=false}if(date.valueOf()<midnight(new Date).valueOf()){addAlert("date","Date selected is in the past.");valid=false}if(!name||name.length<1||name.length>50){addAlert("name","Name must be between 1 and 50 characters.");valid=false}if(!phone||isNaN(phone)||phone<1e9||phone>9999999999){addAlert("phone","Phone number must be in the format ########## and 10 digits.");valid=false}if(!partySize||isNaN(partySize)||partySize<1||partySize>99){addAlert("partySize","Party Size must be between 1 and 99 people.");valid=false}return valid}function midnight(date){return new Date(date.getFullYear(),date.getMonth(),date.getDate())}function addAlert(field,message){var $alerts=document.getElementById("perfect-alerts");$alerts.innerHTML+=alertTemplate({field:field,message:message});var $button=$alerts.getElementsByTagName("button")[0],$field=document.getElementById("perfect-"+field);classes($field).add("perfect-error");events.bind($button,"click",function(e){var dismiss=e.target.attributes["data-dismiss"];$alerts.getElementsByClassName(dismiss)[0].remove()});events.bind($field,"change",function(e){classes($field).remove("perfect-error")})}function setTimeAndSubmitDisabled(disabled){debug("setting time and submit disabled (%s)",disabled);var $time=document.getElementById("perfect-time"),$submit=document.getElementById("perfect-submit");if(disabled){$time.setAttribute("disabled");$submit.setAttribute("disabled")}else{$time.removeAttribute("disabled");$submit.removeAttribute("disabled")}}function getPartySize(){var $partySize=document.getElementById("perfect-party-size");return parseInt(value($partySize),10)}function getDate(){var $date=document.getElementById("perfect-date"),date=new Date(value($date));date.setDate(date.getDate()+1);if(isNaN(date.valueOf())){var text=value($date).split("-");date=new Date(text[0],text[1]-1,text[2])}return date}function numericInputOnly(e){var key=e.charCode||e.keyCode||0;if(key===8||key===46||key>=37&&key<=40||key>=48&&key<=57&&!e.shiftKey||key>=96&&key<=105&&!e.shiftKey){return}else{e.preventDefault()}}function spin(){var spinner=new Spinner,$perfectSpinner=document.getElementById("perfect-spinner");if($perfectSpinner){$perfectSpinner.appendChild(spinner.el)}return{stop:function(){spinner.stop();if($perfectSpinner){$perfectSpinner.innerText=null}}}}function get(url,callback){var spinner=spin();superagent.get(PERFECT_API_URL+url).set({"X-Perfect-API-Key":PERFECT_API_KEY,"X-Perfect-API-Version":PERFECT_API_VERSION}).end(function(err,res){spinner.stop();if(err){callback(err,res)}else if(res.error){callback(res.error,res)}else{callback(null,res.body)}})}function post(url,data,callback){var spinner=spin();superagent.post(PERFECT_API_URL+url).send(data).set({"X-Perfect-API-Key":PERFECT_API_KEY,"X-Perfect-API-Version":PERFECT_API_VERSION}).end(function(err,res){spinner.stop();if(err){callback(err,res)}else if(res.error){callback(res.error,res)}else{callback(null,res.body)}})}});require.register("reservation-form.js/template/alert.js",function(exports,require,module){module.exports=function anonymous(obj){function escape(html){return String(html).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function section(obj,prop,negate,str){var val=obj[prop];if("function"==typeof val)return val.call(obj,str);if(negate)val=!val;if(val)return str;return""}return'<div class="perfect-alert perfect-'+escape(obj.field)+'-alert"><button class="perfect-alert-close" data-dismiss="perfect-'+escape(obj.field)+'-alert">x</button>'+escape(obj.message)+"</div>"}});require.register("reservation-form.js/template/confirm.js",function(exports,require,module){module.exports=function anonymous(obj){function escape(html){return String(html).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function section(obj,prop,negate,str){var val=obj[prop];if("function"==typeof val)return val.call(obj,str);if(negate)val=!val;if(val)return str;return""}return'<div id="perfect-confirm">\n  <h3>Confirm Reservation</h3>\n  <p>Confirm that you would like to create a reservation for '+escape(obj.name)+" with party of "+escape(obj.partySize)+" on "+escape(obj.date)+" at "+escape(obj.time)+'. You will not be able to create another reservation at this restaurant on this date.</p>\n  <button id="perfect-confirm-button">Confirm Reservation</button>\n  <button id="perfect-go-back">Go Back</button>\n</div>'}});require.register("reservation-form.js/template/form.js",function(exports,require,module){module.exports=function anonymous(obj){function escape(html){return String(html).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function section(obj,prop,negate,str){var val=obj[prop];if("function"==typeof val)return val.call(obj,str);if(negate)val=!val;if(val)return str;return""}return'<form action="#">\n  <fieldset>\n    <legend>Reservations</legend>\n    <div id="perfect-spinner"></div>\n    <div id="perfect-create">\n      <h3>Find a Reservation</h3>\n      <div id="perfect-alerts" class="perfect-input-group"></div>\n      <div class="perfect-input-group">\n        <label for="name">Name</label>\n        <input id="perfect-name" type="text" name="name" maxlength="40" required autofocus>\n      </div>\n      <div class="perfect-input-group">\n        <label for="phone">Phone</label>\n        <input id="perfect-phone" type="tel" name="phone" maxlength="10" required>\n        <span>Phone must be able to receive SMS messages.</span>\n      </div>\n      <div class="perfect-input-group">\n        <label for="email">Email</label>\n        <input id="perfect-email" type="email" name="email" maxlength="50" required>\n      </div>\n      <div class="perfect-input-group">\n        <label for="date">Date</label>\n        <input id="perfect-date" type="date" name="date" required>\n      </div>\n      <div class="perfect-input-group">\n        <label for="party-size">Party Size</label>\n        <select id="perfect-party-size" name="party-size">\n          <option value="0" selected="true">Select Size</option>\n        </select>\n      </div>\n      <div class="perfect-input-group">\n        <label for="time">Time</label>\n        <select id="perfect-time" name="time" disabled="true"></select>\n      </div>\n      <div class="perfect-input-group">\n        <input id="perfect-submit" type="submit" value="Make Reservation" disabled="true">\n      </div>\n    </div>\n  </fieldset>\n</form>'
}});require.register("reservation-form.js/template/success.js",function(exports,require,module){module.exports=function anonymous(obj){function escape(html){return String(html).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function section(obj,prop,negate,str){var val=obj[prop];if("function"==typeof val)return val.call(obj,str);if(negate)val=!val;if(val)return str;return""}return'<div id="perfect-success">\n  <h3>Reservation Confirmed</h3>\n  <p>Your reservation for a party of '+escape(obj.partySize)+" on "+escape(obj.date)+" at "+escape(obj.time)+" has been created. You will receive a confirmation text shortly.</p>\n  <p>We look forward to seeing you then!</p>\n</div>"}});require.alias("component-classes/index.js","reservation-form.js/deps/classes/index.js");require.alias("component-classes/index.js","classes/index.js");require.alias("component-indexof/index.js","component-classes/deps/indexof/index.js");require.alias("component-event/index.js","reservation-form.js/deps/event/index.js");require.alias("component-event/index.js","event/index.js");require.alias("component-spinner/index.js","reservation-form.js/deps/spinner/index.js");require.alias("component-spinner/index.js","spinner/index.js");require.alias("component-autoscale-canvas/index.js","component-spinner/deps/autoscale-canvas/index.js");require.alias("component-raf/index.js","component-spinner/deps/raf/index.js");require.alias("component-value/index.js","reservation-form.js/deps/value/index.js");require.alias("component-value/index.js","reservation-form.js/deps/value/index.js");require.alias("component-value/index.js","value/index.js");require.alias("component-type/index.js","component-value/deps/type/index.js");require.alias("component-value/index.js","component-value/index.js");require.alias("jb55-domready/index.js","reservation-form.js/deps/domready/index.js");require.alias("jb55-domready/index.js","domready/index.js");require.alias("visionmedia-debug/index.js","reservation-form.js/deps/debug/index.js");require.alias("visionmedia-debug/debug.js","reservation-form.js/deps/debug/debug.js");require.alias("visionmedia-debug/index.js","debug/index.js");require.alias("visionmedia-superagent/lib/client.js","reservation-form.js/deps/superagent/lib/client.js");require.alias("visionmedia-superagent/lib/client.js","reservation-form.js/deps/superagent/index.js");require.alias("visionmedia-superagent/lib/client.js","superagent/index.js");require.alias("component-emitter/index.js","visionmedia-superagent/deps/emitter/index.js");require.alias("component-indexof/index.js","component-emitter/deps/indexof/index.js");require.alias("RedVentures-reduce/index.js","visionmedia-superagent/deps/reduce/index.js");require.alias("visionmedia-superagent/lib/client.js","visionmedia-superagent/index.js");require.alias("reservation-form.js/index.js","reservation-form.js/index.js");if(typeof exports=="object"){module.exports=require("reservation-form.js")}else if(typeof define=="function"&&define.amd){define(function(){return require("reservation-form.js")})}else{this["Reservations"]=require("reservation-form.js")}}();